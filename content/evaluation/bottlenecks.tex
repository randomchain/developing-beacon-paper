\subsection{Bottlenecks}%
\label{sub:bottlenecks}

\subsubsection{Proxies}%
\label{ssub:proxies}
Proxy performance test here.
Probably reasonable results.


\subsubsection{Input Processor --- Building Merkle Trees}%
\label{ssub:input_processor_building_merkle_trees}
The most expensive task performed in a bottleneck, is building the Merkle tree in our input processor.
This task is done periodically when it is time to compute a new random output.
It should not take a significant amount of time, since this would extend the time between the last seen input and publishing the commit.
As such, we examine how the number of leaves, i.e.\ inputs, relates to the time it takes to build the Merkle tree.

In \cref{fig:merkle_build}, a linear growth in build time is seen as a factor of the number of leaves.
The growth is significantly slow, for it to be negligible in our beacon, since there need to be well over 2 million leaves to even result in a build time over three seconds.
We can describe the relationship as follows, where $N$ is the number of leaves:
$$
1.41 \mu\text{s} \cdot N + 1.41 \text{ms}
$$

Admittedly, the build time could be a problem if significantly many inputs are used.
However, in this case one might reimplement the input processor in a more performant language than Python, e.g.\ C.
In fact, the build process could even be parallelized among multiple processes, each building sub trees.
The Merkle roots of the sub trees could then be merged to produce the full Merkle tree.

\begin{figure}
    \centering\footnotesize
    \begin{tikzpicture}
        \begin{axis} [
            width=\axisdefaultwidth,
            height=5cm,
            xlabel=Number of leaves,
            ylabel=time (s),
            legend pos=north west
            ]
            \addplot [only marks, mark=*, mark size=1, color=GoogleBlue] table [col sep=comma, x index=0, y index=1] {sloth_data/merkledata2.csv};
            \addplot [no markers, color=GoogleBlue] table [col sep=comma, x index=0, y={create col/linear regression={y=BUILD}}] {sloth_data/merkledata2.csv};
            \addlegendentry{%
        $\pgfmathprintnumber{\pgfplotstableregressiona} \cdot x
        \pgfmathprintnumber[print sign]{\pgfplotstableregressionb}$}
        \end{axis}
    \end{tikzpicture}
    \caption{Correlation between number of leaves and the time it takes to build that Merkle tree}%
    \label{fig:merkle_build}
\end{figure}
